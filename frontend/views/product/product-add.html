<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Product</title>
    <link rel="stylesheet" href="/assets/management.css" />
    <link rel="stylesheet" href="/assets/desktop-shared.css" />
    <link rel="stylesheet" href="/assets/moblie-nav.css" />
</head>

<body>
    <header>
        <nav class="mobile-nav">
            <a href="/" class="mobile-logo">dokmai4u Shop</a>
            <div id="hamburger-icon" class="hamburger-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>

        <div id="mobile-menu" class="mobile-menu">
            <a href="/">Home</a>
            <a href="/search">Search</a>
            <a href="/account">Account</a>
            <a style="color: #c800ff;" href="/product">Product</a>
        </div>

        <nav class="desktop-nav">
            <a href="/" class="logo">dokmai4u Shop</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/search">Search</a>
                <a href="/account">Account</a>
                <a style="color: #c800ff;" href="/product">Product</a>
            </div>
        </nav>
    </header>

    <div class="page-wrapper">
        <main class="main-content">
            <div class="container">

                <form id="addForm">
                    <img src="/image/flower.jpg" alt="Flower Image" class="large-icon" />

                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" placeholder="Enter flower name" required />
                    </div>

                    <div class="form-group">
                        <label for="cid">Category</label>
                        <div class="select-wrapper">
                            <select id="cid">
                                <option value="1">Category</option>
                                <option value="2">Bouquet</option>
                                <option value="3">Gift Set</option>
                                <option value="4">Flower Vase</option>
                                <option value="5">Wedding</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="price">Price</label>
                        <input type="number" id="price" placeholder="Enter flower price" min="0" step="1" required />
                    </div>

                    <div class="form-group">
                        <label for="startDate">Available</label>
                        <div class="date-range-inputs">
                            <input type="date" id="startDate" />
                            <span>to</span>
                            <input type="date" id="endDate" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="meaning">Meaning</label>
                        <textarea id="meaning" placeholder="Enter flower meaning" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="srcImage">Image filename</label>
                        <input type="text" id="srcImage" placeholder="e.g., rose.jpg" />
                    </div>

                    <button type="submit" class="primary-btn">Add</button>
                </form>

            </div>
        </main>
    </div>

    <script src="/assets/moblie-nav.js" defer></script>
    <script>
        const $ = (s) => document.querySelector(s);

        $('#addForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const payload = {
                FlowerName: $('#name').value.trim(),
                CID: Number($('#cid').value),
                Price: Number($('#price').value),
                StartDate: $('#startDate').value || null,
                EndDate: $('#endDate').value || null,
                Meaning: $('#meaning').value.trim(),
                srcImage: ($('#srcImage').value.trim() || '')
            };

            if (!payload.FlowerName || Number.isNaN(payload.Price) || !payload.Meaning) {
                alert('Flower name, price, and meaning are required.');
                return;
            }

            try {
                const res = await fetch('http://localhost:3001/api/product/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(payload)
                });

                const data = await res.json()

                if (!res.ok) {
                    alert(data?.message || 'There was an error inserting.');
                    return;
                }

                alert('Flower inserted successfully!');

                location.href = '/product';
            } catch (err) {
                console.error(err);
                alert('An error occurred. Please try again.');
            }
        });
    </script>
</body>

</html>